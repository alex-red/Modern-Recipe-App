var homeCtrl,recipesCtrl,newItemCtrl,shoppingListCtrl,shoppingListModalCtrl,recipeModalCtrl,calculateSmart;angular.module("recipeApp",["ionic"]).factory("db",function(){var t,e;return t={},e=[{name:"Recipe List",data:[{name:"My Recipes",mark:"ion-heart",fn:"Recipe List",col:"assertive",category:"Recipe List"},{name:"Dessert Ideas",fn:"Recipe List",mark:"ion-record",category:"Recipe List"}]},{name:"Shopping List",data:[{name:"Current List",mark:"ion-ios7-star",fn:"Shopping List",col:"calm",category:"Shopping List"}]}],t.current=e[1].data[0],t.user={},t.user.convert=!0,t.getData=function(){return e},t.pushData=function(t){var r,n,i,o,s,a=[];for(r=0,i=(n=e).length;i>r;++r)o=r,s=n[r],s.name===t.category&&a.push(s.data.push(t));return a},t.setCurrent=function(e){t.current=e},t.getCurrent=function(){var r,n,i,o,s,a,l,c,p;for(r=t.current,n=0,o=(i=e).length;o>n;++n)if(s=i[n],s.name===r.category)for(a=0,c=(l=s.data).length;c>a;++a)if(p=l[a],p.name===r.name)return p},t.exists=function(t){var r,n,i,o,s,a,l,c;for(r=0,i=(n=e).length;i>r;++r)for(o=n[r],s=0,l=(a=o.data).length;l>s;++s)if(c=a[s],c.name===t)return!0;return!1},t.getUser=function(){return t.user},t}).config(function(t,e){t.state("index",{url:"/",templateUrl:"home.html",controller:"homeCtrl"}).state("recipes",{url:"/recipes",templateUrl:"recipes.html",controller:"recipesCtrl"}).state("newItem",{url:"/newItem",templateUrl:"newItem.html",controller:"newItemCtrl"}).state("shoppingList",{url:"/shoppingList",templateUrl:"shoppingList.html",controller:"shoppingListCtrl"}),e.otherwise("/")}),homeCtrl=function(t,e,r,n){return r.setCurrent(""),n.$emit("resetFooter",""),t.cats=r.getData(),t.curCat="",t.toShow="",t.addNew=function(){return e.go("newItem")},t.handleClick=function(t){switch(r.current=t,t.fn){case"Recipe List":return e.go("recipes");case"Shopping List":return e.go("shoppingList")}},t.moveItem=function(e,r,n,i){var o,s,a,l,c;for(console.log("from: "+n+" to: "+i+", category: ",r),o=0,a=(s=t.cats).length;a>o;++o)if(l=o,c=s[o],c.name===r)return ionic.Utils.arrayMove(t.cats[l].data,n,i),void 0},t.toggle=function(){return t.showReorder=!t.showReorder}},recipesCtrl=function(t,e,r,n,i){var o;return t.user=r.getUser(),t.data=r.getCurrent(),t.current={},t.data.items||(t.data.items=[{name:"French Fries",category:"Appetizers"},{name:"Lamb Chops",category:"Entrees"},{name:"Lemon Merange Pie",category:"Desserts"}],t.data.categories=["Appetizers","Entrees","Desserts"]),o=function(t,e){var r,i;r="<center><b>"+e+"</b> <br> ",i=n.alert({title:"<b class='assertive'>"+t+"</b>",template:r+"</center>"})},t.newItem=function(e){var r;return t.item={},t.item.title="New "+e+" recipe",t.item.category=e,r=n.show({scope:t,templateUrl:"newRecipeItem.html",buttons:[{text:"Cancel"},{text:"Add",type:"button-positive",onTap:function(e){return t.item.name?t.data.items.push(t.item):(e.preventDefault(),o("Error!","Please enter something."))}}]})},t.newCategory=function(e){var r;return t.item={},t.item.title="New Category",t.item.category=e,r=n.show({scope:t,templateUrl:"newRecipeItem.html",buttons:[{text:"Cancel"},{text:"Add",type:"button-positive",onTap:function(e){return t.item.name?t.data.categories.push(t.item.name):(e.preventDefault(),o("Error!","Please enter something."))}}]})},i.fromTemplateUrl("recipeModal.html",function(e){t.modal=e},{animation:"slide-in-right"}),t.handleImport=function(e){var r,n,i,o,s,a,l,c,p,u,m,f,d,h,g,b,y,v,C,w,L,x,q,k=[];for(r=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},n=function(t){var e,r,n,i,o,s,a;e={tsp:["teaspoon","teaspoons","tsp"],tbsp:["tablespoon","tablespoons","tbsp"],mL:["ml","millilitres","milliliter","millilitre"],cups:["cups"],cup:["cup"],oz:["oz","ounces","ounce"],lbs:["lbs","lb","pounds","pound"]};for(r in e)for(n=e[r],i=0,o=n.length;o>i;++i)if(s=n[i],a=new RegExp("\\b"+s+"\\b"),t.search(a)>=0)return[r,s];return[null,null]},i={"1/2":".5","1/3":".33","1/4":".25","3/4":".75","½":".5","¼":".25","¾":".75","⅓":".33"},o=e.split("\n"),console.log("we got ",o),s=0,a=o.length;a>s;++s)if(l=o[s],!(l.length<=0)){if(c="",-1!==l.indexOf("(")&&(p=l.indexOf("("),u=l.indexOf(")"),c=l.slice(p,u+1),l=l.replace(c,"")),m={},l=l.toLowerCase().trim(),f=n(l),m.type=f[0],m.type)for(d=f[1],h=l.split(d),m.qty=h[0].trim(),m.name=h[1].trim(),g=0,y=(b=m.qty).length;y>g;++g)v=b[g],r(v)||m.qty.replace(v,"");else C=l.indexOf(" "),-1!==C?(h=[l.slice(0,C),l.slice(C+1)],m.qty=r(h[0])?h[0]:"",m.name=h[1]):m.name=l;if(w="",m.qty)for(L in i)x=i[L],-1!==m.qty.indexOf(L)&&(w=m.qty.replace(L,x));m.type&&(console.log("smart: "+m.qty+" "+m.type),q=w||m.qty,m.smartConvert=calculateSmart(q,m.type)),c&&(m.name+=" "+c),"of"===m.name.split(" ")[0]&&(m.name=m.name.replace("of ","")),t.current.ingredients||(t.current.ingredients=[]),k.push(t.current.ingredients.push(m))}return k},t.showRecipe=function(e){return t.current=e,t.current.smartConvert||(t.current.smartConvert=!0),t.modal.current=t.current,t.modal.add=function(e){var r,i;return t.item={},t.item.type="oz",t.cat=[["tsp","tbsp","mL"],["cups","oz","lbs"]],r=function(){switch(!1){case"ingredient"!==e:return"shoppingListPopup.html";case"instruction"!==e:return"instructionPopup.html"}}(),i=n.show({scope:t,templateUrl:r,buttons:[{text:"Cancel"},{text:"Add",type:"button-positive",onTap:function(r){return t.item.name?(t.item.type&&t.item.qty&&(t.item.smartConvert=calculateSmart(t.item.qty,t.item.type)),"ingredient"===e?(t.current.ingredients||(t.current.ingredients=[]),t.current.ingredients.push(t.item)):"instruction"===e&&(t.current.instructions||(t.current.instructions=[]),t.current.instructions.push(t.item)),t.modal.current=t.current):(o("Error!","Please enter an item name."),r.preventDefault())}}]})},t.modal["import"]=function(){return t["import"]={},t.importPop=n.show({scope:t,templateUrl:"importShoppingList.html",buttons:[{text:"Cancel"},{text:"Import",type:"button-positive",onTap:function(e){return t["import"].str?t.handleImport(t["import"].str):e.preventDefault()}}]})},t.modal.smartToggle=function(){return t.current.smartConvert=!t.current.smartConvert,t.modal.current=t.current},t.modal.handleClick=function(t){return t.strike=!t.strike},t.modal.show()},t.setActive=function(e){return t.item.type=t.item.type===e?"":e}},newItemCtrl=function(t,e,r,n){return t.showReorder=!1,t.showDelete=!1,t.colors=["positive","calm","balanced","assertive","dark"],t.icons=["ion-ios7-star","ion-bag","ion-heart","ion-pin","ion-record","ion-ios7-wineglass"],t.categories=["Recipe List","Shopping List"],t.colselected=4,t.iconselected=4,t.showForm=!0,t.list={},t.list.col="dark",t.list.mark="ion-record",t.list.category=t.list.fn,t.submit=function(){var i,o;if(t.list.name){for(o=t.list.name;r.exists(o);)o+=" +";return t.list.name=o,t.list.fn=t.list.category,r.pushData(t.list),e.go("index")}i=n.alert({title:"Error!",template:"<center>Please check your list details.</center>"})},t.exitOut=function(){return e.go("index")},t.colselect=function(e,r){return t.colselected=e,t.list.col=r},t.iconselect=function(e,r){return t.iconselected=e,t.list.mark=r}},shoppingListCtrl=function(t,e,r,n){return t.data=r.getCurrent(),t.data.items||(t.data.items=[],t.data.convert=!0,t.data.sorting=!1),t.newItem=function(){var e;return t.item={},t.item.type="oz",t.cat=[["tsp","tbsp","mL"],["cups","oz","lbs"]],e=n.show({scope:t,templateUrl:"shoppingListPopup.html",buttons:[{text:"Cancel"},{text:"Add",type:"button-positive",onTap:function(e){return t.item.name?(t.item.qty||(t.item.type=""),t.item.type&&(t.item.smartConvert=calculateSmart(t.item.qty,t.item.type)),t.data.items.push(t.item)):(e.preventDefault(),t.showError())}}]})},t.handleImport=function(e){var r,n,i,o,s,a,l,c,p,u,m,f,d,h,g,b,y,v,C,w,L,x,q,k=[];for(r=function(t){return!isNaN(parseFloat(t))&&isFinite(t)},n=function(t){var e,r,n,i,o,s,a;e={tsp:["teaspoon","teaspoons","tsp"],tbsp:["tablespoon","tablespoons","tbsp"],mL:["ml","millilitres","milliliter","millilitre"],cups:["cups"],cup:["cup"],oz:["oz","ounces","ounce"],lbs:["lbs","lb","pounds","pound"]};for(r in e)for(n=e[r],i=0,o=n.length;o>i;++i)if(s=n[i],a=new RegExp("\\b"+s+"\\b"),t.search(a)>=0)return[r,s];return[null,null]},i={"1/2":".5","1/3":".33","1/4":".25","3/4":".75","½":".5","¼":".25","¾":".75","⅓":".33"},o=e.split("\n"),console.log("we got ",o),s=0,a=o.length;a>s;++s)if(l=o[s],!(l.length<=0)){if(c="",-1!==l.indexOf("(")&&(p=l.indexOf("("),u=l.indexOf(")"),c=l.slice(p,u+1),l=l.replace(c,"")),m={},l=l.toLowerCase().trim(),f=n(l),m.type=f[0],m.type)for(d=f[1],h=l.split(d),m.qty=h[0].trim(),m.name=h[1].trim(),g=0,y=(b=m.qty).length;y>g;++g)v=b[g],r(v)||m.qty.replace(v,"");else C=l.indexOf(" "),-1!==C?(h=[l.slice(0,C),l.slice(C+1)],m.qty=r(h[0])?h[0]:"",m.name=h[1]):m.name=l;if(w="",m.qty)for(L in i)x=i[L],-1!==m.qty.indexOf(L)&&(w=m.qty.replace(L,x));m.type&&(console.log("smart: "+m.qty+" "+m.type),q=w||m.qty,m.smartConvert=calculateSmart(q,m.type)),c&&(m.name+=" "+c),"of"===m.name.split(" ")[0]&&(m.name=m.name.replace("of ","")),k.push(t.data.items.push(m))}return k},t.showImport=function(){return t.importPop&&t.importPop.close(),t["import"]={},t.importPop=n.show({scope:t,templateUrl:"importShoppingList.html",buttons:[{text:"Cancel"},{text:"Import",type:"button-positive",onTap:function(e){return t["import"].str?t.handleImport(t["import"].str):(e.preventDefault(),t.showError2())}}]})},t.showError=function(){var e,r;return e="<center><b>Please recheck your item details.</b> <br> ",t.item.name||(e+=" You need an item name. <br>"),r=n.alert({title:"<b class='assertive'>Error!</b>",template:e+"</center>"})},t.showError2=function(){var t;return t=n.alert({title:"<b class='assertive'>Error!</b>",template:"You need to input something in the text box."})},t.setActive=function(e){return t.item.type=t.item.type===e?"":e},t.toggleConvert=function(){return t.data.convert=!t.data.convert},t.toggleSort=function(){return t.data.sorting=t.data.sorting?!1:"strike"},t.clearAll=function(){var e;return e=n.confirm({title:"<b class='assertive'>Trash</b>",template:"<center>Delete all items?</center>",cancelText:"<b class='assertive'>Cancel</b>",okText:"<b class='balanced'>OK</b>"}),e.then(function(e){return e?t.data.items=[]:void 0})}},shoppingListModalCtrl=function(t){return t.data="hello"},recipeModalCtrl=function(t,e,r){t.user=r.getUser(),console.log(t.user)},calculateSmart=function(t,e){var r,n,i,o;switch(r=n=i=o="",e){case"tsp":r=4.92892,i="mL",n=.333333,o="tbsp";break;case"tbsp":r=14.7868,i="mL",n=.0625,o="cups";break;case"mL":r=.00422675,i="cups",n=.202884,o="tsp";break;case"oz":r=28.3495,i="grams",n=29.5735,o="mL";break;case"cups":r=236.588,i="mL",n=8,o="oz";break;case"cup":r=236.588,i="mL",n=8,o="oz";break;case"lbs":r=453.592,i="grams",n=2,o="cups"}return r*=t,n*=t,+r.toFixed(1)+" "+i+" or "+ +n.toFixed(1)+" "+o};